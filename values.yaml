global:
  imageRegistry: ""
  imagePullSecrets: []
  nameOverride: ""
  fullnameOverride: ""
  security:
    allowInsecureImages: true
  serviceAccount:
    create: true
    name: reportportal
    annotations: {}
  argocd:
    enabled: true
  securityContext: {}
  tolerations: []
  pdb:
    create: true
    maxUnavailable: "1"

serviceanalyzer:
  replicaCount: 0
  image:
    repository: reportportal/service-auto-analyzer
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 50m
      memory: 128Mi
  service:
    labels: {}
    annotations: {}

servicejobs:
  replicaCount: 0
  image:
    repository: reportportal/service-jobs
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 50m
      memory: 128Mi
  service:
    labels: {}
    annotations: {}

# --- Keep only essential services with minimal resources ---
serviceindex:
  replicaCount: 1
  image:
    repository: reportportal/service-index
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
  service:
    labels: {}
    annotations: {}

serviceui:
  replicaCount: 1
  image:
    repository: reportportal/service-ui
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
  service:
    labels: {}
    annotations: {}

serviceapi:
  replicaCount: 1
  image:
    repository: reportportal/service-api
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 100m
      memory: 384Mi
    limits:
      cpu: 200m
      memory: 768Mi
  jvmArgs: "-Djava.security.egd=file:/dev/./urandom -XX:+UseG1GC -XX:MinRAMPercentage=60.0 -XX:MaxRAMPercentage=80.0"
  service:
    labels: {}
    annotations: {}

uat:
  replicaCount: 1
  image:
    repository: reportportal/service-authorization
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 80m
      memory: 256Mi
    limits:
      cpu: 150m
      memory: 512Mi
  jvmArgs: "-Djava.security.egd=file:/dev/./urandom -XX:MinRAMPercentage=60.0 -XX:MaxRAMPercentage=80.0"
  service:
    labels: {}
    annotations: {}
  extraInitContainers:
    - name: wait-for-minio
      image: curlimages/curl:8.12.0
      command: ['sh', '-c']
      args:
        - |
          echo "Waiting for MinIO..."
          until nslookup reportportal-minio && \
          curl -sf http://reportportal-minio:9000/minio/health/live; do
            echo "MinIO not ready â€” retrying in 5s..."
            sleep 5
          done
          echo "MinIO is ready!"
# --- Keep migrations (required on first install) ---
migrations:
  image:
    repository: reportportal/migrations
    tag: 5.15.0
    pullPolicy: Always
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 128Mi

# --- Infrastructure: keep but reduce footprint ---
postgresql:
  install: true
  auth:
    postgresPassword: rppassword
    username: postgres
    password: rppassword
    database: reportportal
  primary:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi

rabbitmq:
  install: true
  auth:
    username: rabbitmq
    password: rabbitmqpassword
  persistence:
    enabled: true
    size: 5Gi
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 384Mi
  extraPlugins:
    - rabbitmq_auth_backend_ldap
    - rabbitmq_consistent_hash_exchange
    - rabbitmq_shovel
    - rabbitmq_shovel_management
  extraConfiguration: |-
    max_message_size = 134217728

minio:
  install: true
  auth:
    rootUser: rpuser
    rootPassword: miniopassword
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 256Mi
  persistence:
    annotations:
      "helm.sh/resource-policy": "keep"
  console:
    enabled: false

opensearch:
  install: true
  singleNode: true
  resources:
    requests:
      cpu: 200m
      memory: 1Gi
    limits:
      cpu: 400m
      memory: 1.5Gi
  extraEnvs:
    - name: DISABLE_INSTALL_DEMO_CONFIG
      value: "true"
    - name: DISABLE_SECURITY_PLUGIN
      value: "true"

# --- Storage & DB config (unchanged defaults) ---
database:
  password: rppassword
msgbroker:
  vhost: analyzer
  password: rabbitmqpassword
searchengine:
  ssl: false
storage:
  type: minio
  accesskey: rpuser
  secretkey: miniopassword
  bucket:
    type: single
    bucketDefaultName: "rp-bucket"

# --- Ingress (keep as-is if you need external access) ---
ingress:
  enable: true
  hosts:
    - reportportal.13.93.159.247.nip.io
  path: "/"
  class: nginx
  annotations: {}

# --- Disable resource quota (not needed) ---
resourceQuota:
  enabled: false

# --- RBAC & hooks (keep minimal) ---
rbac:
  create: true
hooks:
  preUpgrade:
    enabled: true
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 128Mi
  test:
    enabled: true
